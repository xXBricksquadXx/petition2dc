<section class="mb-4">
  <h1 class="h3 mb-1">Create a Petition to Congress</h1>
  <div class="text-muted">
    A simple, no-tracker petition page with a public status badge (RECEIVED → …).
  </div>
</section>

<form method="post" action="/petitions" class="row g-4">
  <input type="hidden" name="_csrf" value="<%= csrfToken %>" />

  <div class="col-12 col-lg-8">
    <div class="card">
      <div class="card-body">
        <h2 class="h5">1) Choose the Petition Targets</h2>
        <% if (errors.targets) { %><div class="text-danger small"><%= errors.targets %></div><% } %>

        <div class="d-flex flex-wrap gap-3 mt-2">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="t_senate" name="targets" value="senate"
              <%= values.targets.includes('senate') ? 'checked' : '' %> />
            <label class="form-check-label" for="t_senate">U.S. Senate</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="t_house" name="targets" value="house"
              <%= values.targets.includes('house') ? 'checked' : '' %> />
            <label class="form-check-label" for="t_house">U.S. House</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="t_white_house" name="targets" value="white_house"
              <%= values.targets.includes('white_house') ? 'checked' : '' %> />
            <label class="form-check-label" for="t_white_house">The White House</label>
          </div>
        </div>

        <hr class="my-4" />

        <h2 class="h5">2) Give Your Petition a Title</h2>
        <div class="mb-2 text-muted small">10–140 characters.</div>
        <input
          class="form-control <%= errors.title ? 'is-invalid' : '' %>"
          type="text"
          name="title"
          value="<%= values.title %>"
          placeholder="e.g., Require public receipts for every federal agency petition"
          required
        />
        <% if (errors.title) { %><div class="invalid-feedback"><%= errors.title %></div><% } %>

        <hr class="my-4" />

        <h2 class="h5">3) Create the Call-to-Action</h2>
        <div class="mb-2 text-muted small">Plain text is best. 40–10,000 characters.</div>
        <textarea
          class="form-control <%= errors.body ? 'is-invalid' : '' %>"
          name="body"
          rows="9"
          placeholder="Dear Members of Congress..."
          required
        ><%= values.body %></textarea>
        <% if (errors.body) { %><div class="invalid-feedback"><%= errors.body %></div><% } %>

        <hr class="my-4" />

        <h2 class="h5">4) Select Issue Category</h2>
        <select class="form-select <%= errors.issue_code ? 'is-invalid' : '' %>" name="issue_code">
          <% issues.forEach((i) => { %>
            <option value="<%= i.code %>" <%= Number(values.issue_code) === i.code ? 'selected' : '' %>><%= i.label %></option>
          <% }) %>
        </select>
        <% if (errors.issue_code) { %><div class="invalid-feedback"><%= errors.issue_code %></div><% } %>

        <hr class="my-4" />

        <h2 class="h5">5) Petition Manager Information</h2>
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">First name</label>
            <input class="form-control <%= errors.manager_first ? 'is-invalid' : '' %>" name="manager_first" value="<%= values.manager_first %>" required />
            <% if (errors.manager_first) { %><div class="invalid-feedback"><%= errors.manager_first %></div><% } %>
          </div>
          <div class="col-md-4">
            <label class="form-label">Last name</label>
            <input class="form-control <%= errors.manager_last ? 'is-invalid' : '' %>" name="manager_last" value="<%= values.manager_last %>" required />
            <% if (errors.manager_last) { %><div class="invalid-feedback"><%= errors.manager_last %></div><% } %>
          </div>
          <div class="col-md-4">
            <label class="form-label">Email</label>
            <input class="form-control <%= errors.manager_email ? 'is-invalid' : '' %>" name="manager_email" value="<%= values.manager_email %>" placeholder="email@example.com" required />
            <% if (errors.manager_email) { %><div class="invalid-feedback"><%= errors.manager_email %></div><% } %>
          </div>
        </div>

        <!-- Honeypot: bots fill hidden fields -->
        <div class="visually-hidden">
          <label>Last</label>
          <input type="text" name="last" tabindex="-1" autocomplete="off" />
        </div>

        <div class="mt-4">
          <button class="btn btn-primary" type="submit">Create Petition</button>
          <a class="btn btn-outline-secondary ms-2" href="/">Cancel</a>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-4">
    <div class="card">
      <div class="card-body">
        <h2 class="h5">What this does</h2>
        <ul class="small text-muted mb-0">
          <li>Stores your petition + signatures in SQLite (local-first).</li>
          <li>Shows a public status badge so people feel their action is tracked.</li>
          <li>Admin can update delivery status (queued/sent/acknowledged).</li>
          <li>No ads. No analytics. No Facebook SDK.</li>
        </ul>
      </div>
    </div>
  </div>
</form>
